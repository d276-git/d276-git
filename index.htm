<html>
<head></head>
<body style="text-align: center; margin-top: 20%; font-size: xx-large; font-weight: bolder;"> D276 .! LOADING... </body>
<script>

    SrvCom0 = {
        handleSockMsg: function(msg){
            console.log("Sock Msg -->"+msg.action)

            if(msg.action  && msg.action=="init-view"){
                console.log(msg.dCss)
                let dCSS = document.createElement("style")
                let dSCR = document.createElement("script")
                dCSS.innerHTML = msg.dCss
                dSCR.innerHTML = msg.dScr
                document.head.appendChild(dCSS)
                document.body.innerHTML = msg.dBdy
                document.head.appendChild(dSCR)
                //document.body.appendChild(msg.dBdy)
                //document.head.appendChild(msg.dScr)          

            }
        }
    }

    Sockz0 = {
        sock: null,
        defMsg: {action:"view-init"},
        
        __init: function(newMsg=this.defMsg){
            Sockz0.sock = new WebSocket(
                "wss://54.81.22.220:80",
                "custom"
            );
            Sockz0.sock.onopen = (event) => {
                this.sock.send(JSON.stringify(newMsg))
            };
            
            Sockz0.sock.onmessage = (event) => {
                //X.dbg(event.data);
                mSG = JSON.parse(event.data)
               // X.dbg(mSG);
                SrvCom0.handleSockMsg(mSG)
            };  
        },

        __destroy: function(){
            Sockz0.sock = null
        },

        synkObj: function(obj, wait=0) {
            setTimeout(function(){
                X.dbg(Sockz0.sock.readyState )
                X.dbg("------> 2")
                if(Sockz0.sock.readyState == 1){
                    Sockz0.sock.send(JSON.stringify(obj))
                }
                else {
                    Sockz0.__destroy()
                    Sockz0.__init()
                    Sockz0.synkObj(obj, 1819)
                }
            }, wait) 
        }
    }

    Sockz0.__init();
</script>
</html>
